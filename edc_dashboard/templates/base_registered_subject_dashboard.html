{% extends "base_base_registered_subject_dashboard.html"%}
{% load common_tags %}
{% load admin_urls %}
{% load registered_subject_dashboard_tags %}

{% block dispatch %}
    {% if is_dispatched %}
        <div align="center"><h1>This subject is currently <font color="red">dispatched</font> to {{ dispatch_producer }}. Please do not edit any information.</h1></div>
    {% endif %}
{% endblock%}

{% block membership_forms %} 
    {% for keyed_model in keyed_membership_forms %}
        <A href="{% url keyed_model|get_meta|admin_urlname:'change' keyed_model.id %}?next={{ subject_dashboard_url }}&dashboard_type={{dashboard_type}}&dashboard_model={{dashboard_model}}&dashboard_id={{dashboard_id}}&show=appointments&registered_subject={{ registered_subject.pk }}&instruction={{ instruction }}{{ membership_form_extra_url_context }}">{{ keyed_model|get_verbose_name }} (complete)</A> |
    {% endfor %}
    {% for unkeyed_membership_form in unkeyed_membership_forms %}
        <span style="background-color:red;">&nbsp;</span>&nbsp;<A href="{% url unkeyed_membership_form|get_meta|admin_urlname:'add' %}?next={{ subject_dashboard_url }}&dashboard_type={{dashboard_type}}&dashboard_model={{dashboard_model}}&dashboard_id={{dashboard_id}}&show=appointments&registered_subject={{ registered_subject.pk }}&instruction={{ instruction }}{{membership_form_extra_url_context}}">{{ unkeyed_membership_form|get_verbose_name }} (new)</A> |
    {% endfor %}  

{% endblock %}

{% block appointments %}
    {% if crf_meta_data %} <I>(Hint: to see all appointments, click 'show appointments' in the Action column below)</I>{% endif%}
    <table>
    <thead>
    <th>Code</th>
    <th>Description</th>
    <th>Type</th>
    <th>Appt. Date</th>
    <th>Status</th>
    <th>Visit Report</th>
    <th>Visit Reason</th>      
    <th>Action</th>                                    
    </thead>
    <tbody>
    {% if not appointments%}
        <tr class="{% cycle 'row1' 'row2' %}"><td colspan="8"><i>No appointments scheduled</i></td></tr>
    {% else %}
        {% for appointment in appointments %}
            <tr class="{% cycle 'row1' 'row2' %}">
            {% include appointment_row_template %}            
            </tr>
        {% endfor %}
    {% endif %}
    </tbody>
    </table>
{% endblock appointments %}

{% block additional_forms %}
    {% if additional_entry_bucket %}    
        
        {% include 'additional_forms_include.html' %}    
        
    {% endif %}      
{% endblock %}


    {% block scheduled_data_collection %}
 
        {{ rendered_scheduled_forms }}
        
    {% endblock scheduled_data_collection %}

    {% block scheduled_requisitions %}

        {{ rendered_scheduled_requisitions }}
        
    {% endblock scheduled_requisitions %}

{% block top_links %}
  {{ block.super }}
  <BR>
   {% if requisition_meta %}
      <a href="{% url requisition_meta|admin_urlname:'changelist' %}?q={{ subject_identifier }}">requisitions</A>
   {% endif %}   
   {% if packinglist_meta %}
      | <a href="{% url packinglist_meta|admin_urlname:'changelist' %}?q={{ subject_identifier }}">packing lists</A>
   {% endif %}   
  
{% endblock top_links %}
